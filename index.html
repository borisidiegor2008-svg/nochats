<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RED_LINE_FINAL_FIX</title>
    <style>
        body { background: #1a0f0f; color: #f5f5dc; font-family: 'Courier New', monospace; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        #chat { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 8px; border-bottom: 2px solid #ff4444; }
        .msg { padding: 8px; border-left: 3px solid #ff4444; background: rgba(255,0,0,0.05); }
        .input-area { background: #000; padding: 15px; display: flex; }
        input { flex: 1; background: none; border: none; color: #f5f5dc; outline: none; font-size: 1.1rem; }
        button { background: #ff4444; border: none; padding: 10px 20px; cursor: pointer; font-weight: bold; }
        .status { font-size: 0.7rem; padding: 5px 20px; background: #ff4444; color: #000; font-weight: bold; }
    </style>
</head>
<body>
    <div class="status" id="st">CONNECTING К СЕРВЕРУ...</div>
    <div id="chat"></div>
    <div class="input-area">
        <input type="text" id="inp" placeholder="Введите сообщение..." autocomplete="off">
        <button id="btn">SEND</button>
    </div>

    <script src="https://cdn.ably.com/lib/ably.min-1.js"></script>
    <script>
        // Временный ключ (бесплатно)
        const ably = new Ably.Realtime('8O_S_A.Yp-u_w:3YvP3iS7vjF9YV6V');
        const channel = ably.channels.get('global-anon-chat');
        
        const chat = document.getElementById('chat');
        const inp = document.getElementById('inp');
        const btn = document.getElementById('btn');
        const st = document.getElementById('st');

        // Когда подключились
        ably.connection.on('connected', () => {
            st.innerText = "PROTOCOL: RED_LINE // STATUS: ONLINE (МГНОВЕННО)";
        });

        // Слушаем сообщения (прилетают сразу всем)
        channel.subscribe('msg', (message) => {
            const d = document.createElement('div');
            d.className = 'msg';
            d.innerHTML = `<small style="opacity:0.5">[${new Date().toLocaleTimeString()}]</small> ${message.data}`;
            chat.appendChild(d);
            chat.scrollTop = chat.scrollHeight;
        });

        // Функция отправки
        function sendMsg() {
            const text = inp.value.trim();
            if (text) {
                channel.publish('msg', text);
                inp.value = '';
            }
        }

        btn.onclick = sendMsg;
        inp.onkeypress = (e) => { if(e.key === 'Enter') sendMsg(); };
    </script>
</body>
</html>

